#!/sbin/busybox sh

cd /

mount -t proc proc /proc
mount -t sysfs sysfs /sys

mkdir -p /dev/block
mknod /dev/block/mmcblk0p37 b 179 37

mount -t ext4 /dev/block/mmcblk0p37 /data

out() {
    umount -f /data

    chmod 755 /init
    chmod 644 /*.qcom
    chmod 644 /*.rc
    chmod 644 /*.prop

    exec /init
}

ROM=`cat /data/media/.rom`

if grep -q "androidboot.mode=recovery" /proc/cmdline ; then
    mv -f /res/recovery/* /
    out
fi

[ "$ROM" == "2" ] && mv -f /init.qcom.rc.third /init.qcom.rc
[ "$ROM" == "3" ] && mv -f /init.qcom.rc.fourth /init.qcom.rc
[ "$ROM" == "4" ] && mv -f /init.qcom.rc.fifth /init.qcom.rc

out